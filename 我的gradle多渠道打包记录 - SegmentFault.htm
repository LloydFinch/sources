<!DOCTYPE html>
<html lang="zh-CN"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><script src="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/fixed7o.js" async="" charset="utf-8"></script><script src="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/ecom_003" async="" charset="utf-8"></script><script src="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/ecom_005" async="" charset="utf-8"></script><script src="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/ecom" async="" charset="utf-8"></script><script src="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/ecom_004" async="" charset="utf-8"></script><script src="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/ecom_002" async="" charset="utf-8"></script>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="renderer" content="webkit">
    <meta property="qc:admins" content="15317273575564615446375">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimal-ui, maximum-scale=1, user-scalable=no">
    <meta name="alexaVerifyID" content="LkzCRJ7rPEUwt6fVey2vhxiw1vQ">
    <meta name="apple-itunes-app" content="app-id=958101793, app-argument=">
    <title>我的gradle多渠道打包记录 - SegmentFault</title>


            <meta name="description" content="关于android数字签名的作用，参见：http://blog.sina.com.cn/s/blog_4a4f9fb50101db1f.html 生成keystore 参见官网签名说明文档：http://developer.android.com/intl/zh-cn/tools/publishing/app-signing.html 在...">
    
            <meta name="keywords" content="android gradle">
    
    <link rel="search" type="application/opensearchdescription+xml" href="http://segmentfault.com/opensearch.xml" title="SegmentFault">
    <link rel="shortcut icon" href="http://static.segmentfault.com/global/img/favicon.30f7204d.ico">
    <link rel="apple-touch-icon" href="http://static.segmentfault.com/global/img/touch-icon.c78b1075.png">

    <meta name="msapplication-TileColor" content="#009a61">
    <meta name="msapplication-square150x150logo" content="http://static.segmentfault.com/global/img/touch-icon.c78b1075.png">

    <meta name="userId" value="" id="SFUserId">
    <meta name="userRank" value="" id="SFUserRank">

    <link rel="alternate" type="application/atom+xml" title="SegmentFault 最新问题" href="http://segmentfault.com/feeds/questions">
    <link rel="alternate" type="application/atom+xml" title="SegmentFault 最新文章" href="http://segmentfault.com/feeds/blogs">
    
    
    
                    <link rel="stylesheet" href="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/global.css">
                            <link rel="stylesheet" href="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/blog_all.css">
                <link rel="stylesheet" href="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/responsive.css">
        
    <!--[if lt IE 9]>
    <link rel="stylesheet" href="http://static.segmentfault.com/global/css/ie.css?"/>
    <script src="http://static.segmentfault.com/global/js/html5shiv.js?"></script>
    <script src="http://static.segmentfault.com/global/js/respond.js?"></script>
    <![endif]-->

</head>

<body class="blog-post"><div style="position: absolute; left: -1px; bottom: -1px; z-index: 0; width: 0px; height: 0px; overflow: hidden; visibility: hidden; display: none;" id="BAIDU_DUP_fp_wrapper"><iframe style="width: 0px; height: 0px; visibility: hidden; display: none;" src="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/o.htm" id="BAIDU_DUP_fp_iframe"></iframe></div>
<!--[if lt IE 9]>
<div class="alert alert-danger topframe" role="alert">你的浏览器实在<strong>太太太太太太旧了</strong>，放学别走，升级完浏览器再说 <a target="_blank"
                                                                                                        class="alert-link"
                                                                                                        href="http://browsehappy.com">立即升级</a>
</div>
<![endif]-->


<div class="global-nav">
    <nav class="container nav">
        <div class="dropdown m-menu">
            <a href="javascript:void(0);" id="dLabel" class="visible-xs-block m-toptools" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="glyphicon glyphicon-align-justify"></span>
                <span class="mobile-menu__unreadpoint"></span>
            </a>
            <ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">
                <li class="mobile-menu__item"><a href="http://segmentfault.com/questions/newest">问答</a></li>
                <li class="mobile-menu__item"><a href="http://segmentfault.com/blogs">文章</a></li>
                <li class="mobile-menu__item"><a href="http://segmentfault.com/notes">笔记</a></li>
                <li class="mobile-menu__item"><a href="http://segmentfault.com/jobs">职位</a></li>
                <li class="mobile-menu__item"><a href="http://segmentfault.com/events">活动</a></li>

                <li class="mobile-menu__item"><a href="http://segmentfault.com/tags">标签</a></li>
                <li class="mobile-menu__item"><a href="http://segmentfault.com/users">榜单</a></li>
                <li class="mobile-menu__item"><a href="http://segmentfault.com/sites">子站</a></li>
                            </ul>
        </div>

        <h1 class="logo"><a class="sf" href="http://segmentfault.com/">SegmentFault</a></h1>

                <a href="http://segmentfault.com/user/login" class="visible-xs-block pull-right m-ask m-toptools"><span class="glyphicon glyphicon-log-in"></span></a>
        
        <form action="/search" class="header-search pull-left hidden-sm hidden-xs">
            <button type="submit" class="btn btn-link"><span class="sr-only">搜索</span><span class="glyphicon glyphicon-search"></span></button>
            <input id="searchBox" name="q" placeholder="输入关键字搜索" class="form-control" type="text">
        </form>

        <ul class="menu list-inline pull-left hidden-xs">
            <li class="menu__item"><a href="http://segmentfault.com/questions">问答</a></li>
            <li class="menu__item"><a href="http://segmentfault.com/blogs">文章</a></li>
            <li class="menu__item menu__item--dotted"><a href="http://segmentfault.com/notes">笔记 <span data-mod="note" class="header__menu--highlight hide"></span> </a></li>
            <li class="menu__item menu__item--dotted"><a href="http://segmentfault.com/jobs">职位 <span data-mod="job" class="header__menu--highlight hide"></span> </a></li>


            <li class="menu__item dropdown hoverDropdown">
                <a data-toggle="dropdown" href="http://segmentfault.com/sites" class="more dropdownBtn">
                    ···<span class="sr-only">更多</span>
                </a>
                <ul class="dropdown-menu">
                    <li><a href="http://segmentfault.com/events">活动</a></li>
                    <li><a href="http://segmentfault.com/users">榜单</a></li>
                    <li><a href="http://segmentfault.com/tags">标签</a></li>
                    <li><a href="http://segmentfault.com/sites">子站</a></li>
                    <li><a href="http://segmentfault.com/app">移动 App</a></li>
                </ul>
            </li>
        </ul>

        <ul class="opts pull-right list-inline hidden-xs">
                    <!-- <li class="opts__item">赶快加入吧 <a id="sfLogin" href="/user/login" class="SFLogin em ml10" onClick="_gaq.push(['_trackEvent', 'Button', 'Click', 'Login']);">立即登录</a></li> -->
            <li class="opts__item message has-unread">
                <a target="_blank" href="http://segmentfault.com/tour">
                    <span class="sr-only">消息</span>
                    <span id="messageCount" class="glyphicon glyphicon-envelope"></span>
                </a>
            </li>
            <li class="opts__item">
                <a href="http://segmentfault.com/user/login" class="SFLogin em ml10" onclick="_gaq.push(['_trackEvent', 'Button', 'Click', 'Login']);">注册 · 登录</a>
            </li>
                    </ul>
    </nav>
</div>

<div class="wrap">
    <div class="post-topheader custom-sanchi">
        <div class="container">
            <div class="row">
                <div class="col-md-9">
                    <ol class="breadcrumb">
                        <li><a href="http://segmentfault.com/blogs">文章</a></li>
                        <li><a href="http://segmentfault.com/blog/sanchi">share</a></li>
                        <li class="active">文章详情</li>
                    </ol>
                    <h1 class="h3 title" id="articleTitle" data-id="1190000003763833"><a href="http://segmentfault.com/a/1190000003763833"> 我的gradle多渠道打包记录</a></h1>
                    <div class="author" data-username="暗黑物质" data-userslug="sanchi" data-useravatar="http://sfault-avatar.b0.upaiyun.com/393/866/3938667287-5524c30322d0b_huge128">
                        <a href="http://segmentfault.com/u/sanchi" class="mr5"><img class="avatar-24 mr10" src="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/3938667287-5524c30322d0b_huge128.jpg" alt="暗黑物质"><strong>暗黑物质</strong></a> <strong class="text-black mr10">110</strong>
                        9月18日 发布
                                                                    </div>
                </div>
                <div class="col-md-3">
                    <ul class="widget-action--ver list-unstyled">
                        <li>
                                                                                            <button type="button" class="btn btn-success btn-sm" data-id="1190000003763833" id="sideLike">推荐</button>
                                                                                        <strong id="sideLiked">0</strong> 推荐
                        </li>
                        <li>
                                                                                            <button type="button" id="sideBookmark" class="btn btn-default btn-sm" data-id="1190000003763833" data-type="article">收藏</button>
                                                                                        <strong id="sideBookmarked">7</strong> 收藏，<strong class="no-stress">692</strong> 浏览
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div><!-- end .post-topheader -->

    <div class="container mt30">
        <div class="row">
            <div class="col-xs-12 col-md-9 main">

                                                <div class="article fmt">
                    
<p>关于android数字签名的作用，参见：<a target="_blank" href="http://blog.sina.com.cn/s/blog_4a4f9fb50101db1f.html">http://blog.sina.com.cn/s/blog_4a4f9fb50101db1f.html</a></p>
<h2 id="articleHeader0">生成keystore</h2>
<p>参见官网签名说明文档：<a target="_blank" href="http://developer.android.com/intl/zh-cn/tools/publishing/app-signing.html">http://developer.android.com/intl/zh-cn/tools/publishing/app-signing.html</a></p>
<h4>在android studio中</h4>
<p>build-&gt;generate signed APK-&gt;create new.按顺序填写之后生成签名所需的keystore文件。<br><img src="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/006dvlfWgw1ew6mwgldolj30a307sta0.jpg" alt="" title=""><br><img src="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/006dvlfWjw1ew6mx5t467j30e50dign0.jpg" alt="" title=""></p>
<h4>用命令行</h4>
<blockquote><p>keytool -genkey -v -keystore my-release-key.keystore -alias alias_name -keyalg RSA -keysize 2048 -validity 10000</p></blockquote>
<p><img src="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/006dvlfWjw1ew6mxmq82bj30ud0i5goi.jpg" alt="" title=""></p>
<p>按上图命令分别输入的是签名文件名，别名，指明生成的是2048位RSA秘钥，签名有效期。</p>
<h2 id="articleHeader1">我的打包记录</h2>
<p>这部分内容参考自：<a target="_blank" href="http://www.stormzhang.com/devtools/2015/01/15/android-studio-tutorial6/">http://www.stormzhang.com/devtools/2015/01/15/android-studio-tutorial6/</a></p>
<p>android studio 多渠道打包CMD命令：<code>gradle assembleRelease</code><br>需要在命令提示行（管理员）中定位到项目位置，然后输入<code>gradle</code>初始化gradle环境，然后输入如上命令。</p>
<h4>我的gradle打包示例一</h4>
<p>android studio中build.gradle示例配置如下，将全部渠道名写入<code>channel.txt</code>文件中，放到app文件夹下面，并将keystore文件放到相同位置。新添加渠道的时候不需要改动build.gradle文件，只需在channel.txt文件中添加新的渠道名就可以了。打包完成之后会生成未签名与签名的两种apk包：</p>
<div class="widget-codetool" style="display: none;"><button class="selectCode btn btn-xs">全选</button><button href="javascript:void(0);" class="copyCode btn btn-xs" data-clipboard-text="apply plugin: 'com.android.application'

def releaseTime() {
    return new Date().format(&quot;yyyy-MM-dd&quot;, TimeZone.getTimeZone(&quot;UTC&quot;))
}

def keyStore = file('sign.keystore')

android {
    compileSdkVersion 22
    buildToolsVersion &quot;23.0.0&quot;

    defaultConfig {
        applicationId &quot;com.zrp.test&quot;
        minSdkVersion 9
        targetSdkVersion 22
        versionCode 1
        versionName &quot;1.0&quot;
    }

    packagingOptions {
        exclude 'META-INF/DEPENDENCIES.txt'
        exclude 'META-INF/LICENSE.txt'
        exclude 'META-INF/NOTICE.txt'
        exclude 'META-INF/NOTICE'
        exclude 'META-INF/LICENSE'
        exclude 'META-INF/DEPENDENCIES'
        exclude 'META-INF/notice.txt'
        exclude 'META-INF/license.txt'
        exclude 'META-INF/dependencies.txt'
        exclude 'META-INF/LGPL2.1'
    }

    // Remove warnings
    lintOptions {
        checkReleaseBuilds false
        // Or, if you prefer, you can continue to check for errors in release builds,
        // but continue the build even when errors are found:
        abortOnError false
    }

    // productFlavors
    productFlavors {
        def path = &quot;./channel.txt&quot;
        file(path).eachLine { channel -&gt;
            &quot;$channel&quot; {
                manifestPlaceholders = [UMENG_VALUE: channel]
            }
        }
    }

    signingConfigs {
        app {
            storeFile file('sign.keystore')
            storePassword project.hasProperty('STOREPASS') ? STOREPASS : '你的秘钥库口令'
            keyAlias project.hasProperty('KEYALIAS') ? KEYALIAS : '别名'
            keyPassword project.hasProperty('KEYPASS') ? KEYPASS : '秘钥口令'
        }
    }

    buildTypes {
        release {
            // 不显示Log
            buildConfigField &quot;boolean&quot;, &quot;LOG_DEBUG&quot;, &quot;false&quot;

            debuggable false
            minifyEnabled true
            shrinkResources true
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
            if (keyStore.exists()) {
                println &quot;using test key&quot;
                signingConfig signingConfigs.app
            } else {
                println &quot;---------------using default key---------------&quot;
            }

            android.applicationVariants.all { variant -&gt;
                variant.outputs.each { output -&gt;
                    def outputFile = output.outputFile
                    if (outputFile != null &amp;&amp; outputFile.name.endsWith('.apk')) {
                        // 输出apk名称为test_v1.0_2015-01-15_wandoujia.apk
                        def fileName = &quot;test_v${defaultConfig.versionName}_${releaseTime()}_${variant.productFlavors[0].name}.apk&quot;
                        output.outputFile = new File(outputFile.parent, fileName)
                    }
                }
            }
        }
    }
}
dependencies {
    compile fileTree(include: ['*.jar'], dir: 'libs')
    compile 'com.android.support:appcompat-v7:22.+'
}" data-toggle="tooltip" data-placement="top" title="">复制</button><button href="javascript:void(0);" class="saveToNote btn btn-xs">放进笔记</button></div><pre class="hljs php"><code>apply plugin: <span class="hljs-string">'com.android.application'</span>

def releaseTime() {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Date().format(<span class="hljs-string">"yyyy-MM-dd"</span>, TimeZone.getTimeZone(<span class="hljs-string">"UTC"</span>))
}

def keyStore = file(<span class="hljs-string">'sign.keystore'</span>)

android {
    compileSdkVersion <span class="hljs-number">22</span>
    buildToolsVersion <span class="hljs-string">"23.0.0"</span>

    defaultConfig {
        applicationId <span class="hljs-string">"com.zrp.test"</span>
        minSdkVersion <span class="hljs-number">9</span>
        targetSdkVersion <span class="hljs-number">22</span>
        versionCode <span class="hljs-number">1</span>
        versionName <span class="hljs-string">"1.0"</span>
    }

    packagingOptions {
        exclude <span class="hljs-string">'META-INF/DEPENDENCIES.txt'</span>
        exclude <span class="hljs-string">'META-INF/LICENSE.txt'</span>
        exclude <span class="hljs-string">'META-INF/NOTICE.txt'</span>
        exclude <span class="hljs-string">'META-INF/NOTICE'</span>
        exclude <span class="hljs-string">'META-INF/LICENSE'</span>
        exclude <span class="hljs-string">'META-INF/DEPENDENCIES'</span>
        exclude <span class="hljs-string">'META-INF/notice.txt'</span>
        exclude <span class="hljs-string">'META-INF/license.txt'</span>
        exclude <span class="hljs-string">'META-INF/dependencies.txt'</span>
        exclude <span class="hljs-string">'META-INF/LGPL2.1'</span>
    }

    <span class="hljs-comment">// Remove warnings</span>
    lintOptions {
        checkReleaseBuilds <span class="hljs-keyword">false</span>
        <span class="hljs-comment">// Or, if you prefer, you can continue to check for errors in release builds,</span>
        <span class="hljs-comment">// but continue the build even when errors are found:</span>
        abortOnError <span class="hljs-keyword">false</span>
    }

    <span class="hljs-comment">// productFlavors</span>
    productFlavors {
        def path = <span class="hljs-string">"./channel.txt"</span>
        file(path).eachLine { channel -&gt;
            <span class="hljs-string">"$channel"</span> {
                manifestPlaceholders = [UMENG_VALUE: channel]
            }
        }
    }

    signingConfigs {
        app {
            storeFile file(<span class="hljs-string">'sign.keystore'</span>)
            storePassword project.hasProperty(<span class="hljs-string">'STOREPASS'</span>) ? STOREPASS : <span class="hljs-string">'你的秘钥库口令'</span>
            keyAlias project.hasProperty(<span class="hljs-string">'KEYALIAS'</span>) ? KEYALIAS : <span class="hljs-string">'别名'</span>
            keyPassword project.hasProperty(<span class="hljs-string">'KEYPASS'</span>) ? KEYPASS : <span class="hljs-string">'秘钥口令'</span>
        }
    }

    buildTypes {
        release {
            <span class="hljs-comment">// 不显示Log</span>
            buildConfigField <span class="hljs-string">"boolean"</span>, <span class="hljs-string">"LOG_DEBUG"</span>, <span class="hljs-string">"false"</span>

            debuggable <span class="hljs-keyword">false</span>
            minifyEnabled <span class="hljs-keyword">true</span>
            shrinkResources <span class="hljs-keyword">true</span>
            proguardFiles getDefaultProguardFile(<span class="hljs-string">'proguard-android.txt'</span>), <span class="hljs-string">'proguard-rules.pro'</span>
            <span class="hljs-keyword">if</span> (keyStore.exists()) {
                println <span class="hljs-string">"using test key"</span>
                signingConfig signingConfigs.app
            } <span class="hljs-keyword">else</span> {
                println <span class="hljs-string">"---------------using default key---------------"</span>
            }

            android.applicationVariants.all { variant -&gt;
                variant.outputs.each { output -&gt;
                    def outputFile = output.outputFile
                    <span class="hljs-keyword">if</span> (outputFile != <span class="hljs-keyword">null</span> &amp;&amp; outputFile.name.endsWith(<span class="hljs-string">'.apk'</span>)) {
                        <span class="hljs-comment">// 输出apk名称为test_v1.0_2015-01-15_wandoujia.apk</span>
                        def fileName = <span class="hljs-string">"test_v${defaultConfig.versionName}_${releaseTime()}_${variant.productFlavors[0].name}.apk"</span>
                        output.outputFile = <span class="hljs-keyword">new</span> File(outputFile.<span class="hljs-keyword">parent</span>, fileName)
                    }
                }
            }
        }
    }
}
dependencies {
    compile fileTree(<span class="hljs-keyword">include</span>: [<span class="hljs-string">'*.jar'</span>], dir: <span class="hljs-string">'libs'</span>)
    compile <span class="hljs-string">'com.android.support:appcompat-v7:22.+'</span>
}</code></pre>
<p>如上gradle文件中，如果未使用签名文件打包，会出现<code>INSTALL_PARSE_FAILED_NO_CERTIFICATES</code>，或<code>INSTALL_PARSE_FAILED_UNEXPECTED_EXCEPTION</code>错误，导致安装失败。所以，<strong>一定要使用签名文件进行打包签名，不然用会导致应用安装失败！</strong></p>
<h4>我的gradle打包示例二</h4>
<div class="widget-codetool" style="display: none;"><button class="selectCode btn btn-xs">全选</button><button href="javascript:void(0);" class="copyCode btn btn-xs" data-clipboard-text="apply plugin: 'com.android.application'

def releaseTime() {
    return new Date().format(&quot;yyyy-MM-dd&quot;, TimeZone.getTimeZone(&quot;UTC&quot;))
}

android {
    compileSdkVersion 22
    buildToolsVersion '23.0.0'

    defaultConfig {
        applicationId &quot;com.zrp.test&quot;
        minSdkVersion 9
        targetSdkVersion 22
        versionCode 1
        versionName &quot;1.0&quot;

        // dex突破65535的限制
        multiDexEnabled true
        // 默认是umeng的渠道
        manifestPlaceholders = [UMENG_CHANNEL_VALUE: &quot;umeng&quot;]
    }

    lintOptions {
        abortOnError false
    }

    signingConfigs {
        debug {
            // No debug config
        }

        release {
            storeFile file(&quot;../sign.keystore&quot;)
            storePassword &quot;秘钥库口令&quot;
            keyAlias &quot;别名&quot;
            keyPassword &quot;秘钥口令&quot;
        }
    }

    buildTypes {
        debug {
            // 显示Log
            buildConfigField &quot;boolean&quot;, &quot;LOG_DEBUG&quot;, &quot;true&quot;

            versionNameSuffix &quot;-debug&quot;
            minifyEnabled false
            zipAlignEnabled false
            shrinkResources false
            signingConfig signingConfigs.debug
        }

        release {
            // 不显示Log
            buildConfigField &quot;boolean&quot;, &quot;LOG_DEBUG&quot;, &quot;false&quot;

            minifyEnabled true
            zipAlignEnabled true
            // 移除无用的resource文件
            shrinkResources true
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
            signingConfig signingConfigs.release

            applicationVariants.all { variant -&gt;
                variant.outputs.each { output -&gt;
                    def outputFile = output.outputFile
                    if (outputFile != null &amp;&amp; outputFile.name.endsWith('.apk')) {
                        // 输出apk名称为test_v1.0_2015-01-15_wandoujia.apk
                        def fileName = &quot;test_v${defaultConfig.versionName}_${releaseTime()}_${variant.productFlavors[0].name}.apk&quot;
                        output.outputFile = new File(outputFile.parent, fileName)
                    }
                }
            }
        }
    }

    // 友盟多渠道打包
    productFlavors {
        wandoujia {}
//        _360 {}
//        baidu {}
//        xiaomi {}
//        tencent {}
//        taobao {}
    }

    productFlavors.all { flavor -&gt;
        flavor.manifestPlaceholders = [UMENG_CHANNEL_VALUE: name]
    }
}

dependencies {
    compile fileTree(dir: 'libs', include: ['*.jar'])
    compile 'com.android.support:appcompat-v7:22.+'
}
" data-toggle="tooltip" data-placement="top" title="">复制</button><button href="javascript:void(0);" class="saveToNote btn btn-xs">放进笔记</button></div><pre class="hljs php"><code>apply plugin: <span class="hljs-string">'com.android.application'</span>

def releaseTime() {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Date().format(<span class="hljs-string">"yyyy-MM-dd"</span>, TimeZone.getTimeZone(<span class="hljs-string">"UTC"</span>))
}

android {
    compileSdkVersion <span class="hljs-number">22</span>
    buildToolsVersion <span class="hljs-string">'23.0.0'</span>

    defaultConfig {
        applicationId <span class="hljs-string">"com.zrp.test"</span>
        minSdkVersion <span class="hljs-number">9</span>
        targetSdkVersion <span class="hljs-number">22</span>
        versionCode <span class="hljs-number">1</span>
        versionName <span class="hljs-string">"1.0"</span>

        <span class="hljs-comment">// dex突破65535的限制</span>
        multiDexEnabled <span class="hljs-keyword">true</span>
        <span class="hljs-comment">// 默认是umeng的渠道</span>
        manifestPlaceholders = [UMENG_CHANNEL_VALUE: <span class="hljs-string">"umeng"</span>]
    }

    lintOptions {
        abortOnError <span class="hljs-keyword">false</span>
    }

    signingConfigs {
        debug {
            <span class="hljs-comment">// No debug config</span>
        }

        release {
            storeFile file(<span class="hljs-string">"../sign.keystore"</span>)
            storePassword <span class="hljs-string">"秘钥库口令"</span>
            keyAlias <span class="hljs-string">"别名"</span>
            keyPassword <span class="hljs-string">"秘钥口令"</span>
        }
    }

    buildTypes {
        debug {
            <span class="hljs-comment">// 显示Log</span>
            buildConfigField <span class="hljs-string">"boolean"</span>, <span class="hljs-string">"LOG_DEBUG"</span>, <span class="hljs-string">"true"</span>

            versionNameSuffix <span class="hljs-string">"-debug"</span>
            minifyEnabled <span class="hljs-keyword">false</span>
            zipAlignEnabled <span class="hljs-keyword">false</span>
            shrinkResources <span class="hljs-keyword">false</span>
            signingConfig signingConfigs.debug
        }

        release {
            <span class="hljs-comment">// 不显示Log</span>
            buildConfigField <span class="hljs-string">"boolean"</span>, <span class="hljs-string">"LOG_DEBUG"</span>, <span class="hljs-string">"false"</span>

            minifyEnabled <span class="hljs-keyword">true</span>
            zipAlignEnabled <span class="hljs-keyword">true</span>
            <span class="hljs-comment">// 移除无用的resource文件</span>
            shrinkResources <span class="hljs-keyword">true</span>
            proguardFiles getDefaultProguardFile(<span class="hljs-string">'proguard-android.txt'</span>), <span class="hljs-string">'proguard-rules.pro'</span>
            signingConfig signingConfigs.release

            applicationVariants.all { variant -&gt;
                variant.outputs.each { output -&gt;
                    def outputFile = output.outputFile
                    <span class="hljs-keyword">if</span> (outputFile != <span class="hljs-keyword">null</span> &amp;&amp; outputFile.name.endsWith(<span class="hljs-string">'.apk'</span>)) {
                        <span class="hljs-comment">// 输出apk名称为test_v1.0_2015-01-15_wandoujia.apk</span>
                        def fileName = <span class="hljs-string">"test_v${defaultConfig.versionName}_${releaseTime()}_${variant.productFlavors[0].name}.apk"</span>
                        output.outputFile = <span class="hljs-keyword">new</span> File(outputFile.<span class="hljs-keyword">parent</span>, fileName)
                    }
                }
            }
        }
    }

    <span class="hljs-comment">// 友盟多渠道打包</span>
    productFlavors {
        wandoujia {}
<span class="hljs-comment">//        _360 {}</span>
<span class="hljs-comment">//        baidu {}</span>
<span class="hljs-comment">//        xiaomi {}</span>
<span class="hljs-comment">//        tencent {}</span>
<span class="hljs-comment">//        taobao {}</span>
    }

    productFlavors.all { flavor -&gt;
        flavor.manifestPlaceholders = [UMENG_CHANNEL_VALUE: name]
    }
}

dependencies {
    compile fileTree(dir: <span class="hljs-string">'libs'</span>, <span class="hljs-keyword">include</span>: [<span class="hljs-string">'*.jar'</span>])
    compile <span class="hljs-string">'com.android.support:appcompat-v7:22.+'</span>
}
</code></pre>
<p>如果在打包的时候报<code>Unable to compute hash of /../AndroidStudioProjects/../classes.jar</code>错误，说明在打包混淆的时候需要keep一些文件，让他们不要被混淆。<br>可以在<code>proguard-rules.pro</code>文件中添加keep，单独添加的第三方包需要再次添加。</p>
<p>打包完成之后生成的签名包在.\app\build\outputs\apk文件夹下。</p>
<h2 id="articleHeader2">美团的打包方案（现阶段最快）</h2>
<p><strong>这个方案依赖于google的签名机制，如果google改变android的签名机制的话这个方案就无法使用了</strong>。<br>Github上有人写了这个方法的库：<a target="_blank" href="https://github.com/GavinCT/AndroidMultiChannelBuildTool">https://github.com/GavinCT/AndroidMultiChannelBuildTool</a>，其博客讲解网址为：<a target="_blank" href="http://www.cnblogs.com/ct2011/p/4152323.html">http://www.cnblogs.com/ct2011/p/4152323.html</a></p>
<p>美团的打包原文网址：<a target="_blank" href="http://tech.meituan.com/mt-apk-packaging.html">http://tech.meituan.com/mt-apk-packaging.html</a><br>如下为原文摘抄内容：</p>
<p><strong>META-INF</strong><br>如果能直接修改apk的渠道号，而不需要再重新签名能节省不少打包的时间。幸运的是我们找到了这种方法。直接解压apk，解压后的根目录会有一个META-INF目录，如下图所示：<br><img src="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/006dvlfWgw1ew6nc04oaqj305v05rdg2.jpg" alt="" title=""></p>
<p>如果在META-INF目录内添加空文件，可以不用重新签名应用。因此，通过为不同渠道的应用添加不同的空文件，可以唯一标识一个渠道。</p>
<p>下面的python代码用来给apk添加空的渠道文件，渠道名的前缀为mtchannel_：</p>
<div class="widget-codetool" style="display:none;"><button class="selectCode btn btn-xs">全选</button><button href="javascript:void(0);" class="copyCode btn btn-xs" data-clipboard-text="import zipfile
zipped = zipfile.ZipFile(your_apk, 'a', zipfile.ZIP_DEFLATED) 
empty_channel_file = &quot;META-INF/mtchannel_{channel}&quot;.format(channel=your_channel)
zipped.write(your_empty_file, empty_channel_file)" data-toggle="tooltip" data-placement="top" title="">复制</button><button href="javascript:void(0);" class="saveToNote btn btn-xs">放进笔记</button></div><pre class="hljs perl"><code>import zipfile
zipped = zipfile.ZipFile(your_apk, <span class="hljs-string">'a'</span>, zipfile.ZIP_DEFLATED) 
empty_channel_file = <span class="hljs-string">"META-INF/mtchannel_{channel}"</span>.<span class="hljs-keyword">format</span>(channel=your_channel)
zipped.<span class="hljs-keyword">write</span>(your_empty_file, empty_channel_file)</code></pre>
<p>添加完空渠道文件后的目录，META-INFO目录多了一个名为mtchannel_meituan的空文件：<br><img src="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/006dvlfWgw1ew6ncuyor0j308606it91.jpg" alt="" title=""></p>
<p>接下来就可以在Java代码中读取空渠道文件名了：</p>
<div class="widget-codetool" style="display: none;"><button class="selectCode btn btn-xs">全选</button><button href="javascript:void(0);" class="copyCode btn btn-xs" data-clipboard-text="public static String getChannel(Context context) {
        ApplicationInfo appinfo = context.getApplicationInfo();
        String sourceDir = appinfo.sourceDir;
        String ret = &quot;&quot;;
        ZipFile zipfile = null;
        try {
            zipfile = new ZipFile(sourceDir);
            Enumeration&lt;?&gt; entries = zipfile.entries();
            while (entries.hasMoreElements()) {
                ZipEntry entry = ((ZipEntry) entries.nextElement());
                String entryName = entry.getName();
                if (entryName.startsWith(&quot;mtchannel&quot;)) {
                    ret = entryName;
                    break;
                }
            }
        } catch (IOException e) {
            e.printStackTrace();
        } finally {
            if (zipfile != null) {
                try {
                    zipfile.close();
                } catch (IOException e) {
                    e.printStackTrace();
                }
            }
        }

        String[] split = ret.split(&quot;_&quot;);
        if (split != null &amp;&amp; split.length &gt;= 2) {
            return ret.substring(split[0].length() + 1);

        } else {
            return &quot;&quot;;
        }
    }" data-toggle="tooltip" data-placement="top" title="">复制</button><button href="javascript:void(0);" class="saveToNote btn btn-xs">放进笔记</button></div><pre class="hljs javascript"><code>public static <span class="hljs-built_in">String</span> getChannel(Context context) {
        ApplicationInfo appinfo = context.getApplicationInfo();
        <span class="hljs-built_in">String</span> sourceDir = appinfo.sourceDir;
        <span class="hljs-built_in">String</span> ret = <span class="hljs-string">""</span>;
        ZipFile zipfile = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">try</span> {
            zipfile = <span class="hljs-keyword">new</span> ZipFile(sourceDir);
            Enumeration&lt;?&gt; entries = zipfile.entries();
            <span class="hljs-keyword">while</span> (entries.hasMoreElements()) {
                ZipEntry entry = ((ZipEntry) entries.nextElement());
                <span class="hljs-built_in">String</span> entryName = entry.getName();
                <span class="hljs-keyword">if</span> (entryName.startsWith(<span class="hljs-string">"mtchannel"</span>)) {
                    ret = entryName;
                    <span class="hljs-keyword">break</span>;
                }
            }
        } <span class="hljs-keyword">catch</span> (IOException e) {
            e.printStackTrace();
        } <span class="hljs-keyword">finally</span> {
            <span class="hljs-keyword">if</span> (zipfile != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">try</span> {
                    zipfile.close();
                } <span class="hljs-keyword">catch</span> (IOException e) {
                    e.printStackTrace();
                }
            }
        }

        <span class="hljs-built_in">String</span>[] split = ret.split(<span class="hljs-string">"_"</span>);
        <span class="hljs-keyword">if</span> (split != <span class="hljs-literal">null</span> &amp;&amp; split.length &gt;= <span class="hljs-number">2</span>) {
            <span class="hljs-keyword">return</span> ret.substring(split[<span class="hljs-number">0</span>].length() + <span class="hljs-number">1</span>);

        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
        }
    }</code></pre>
<p>这样，每打一个渠道包只需复制一个apk，在META-INF中添加一个使用渠道号命名的空文件即可。这种打包方式速度非常快，900多个渠道不到一分钟就能打完。</p>

                </div>
                                
                <div class="clearfix">

                    <ul class="taglist--inline pull-left">
                                                <li class="tagPopup"><a class="tag" href="http://segmentfault.com/t/android/blogs" data-toggle="popover" data-img="http://sfault-avatar.b0.upaiyun.com/752/833/752833330-1040000000089658_huge100" data-placement="top" data-original-title="android" data-id="1040000000089658">android</a></li>
                                                <li class="tagPopup"><a class="tag" href="http://segmentfault.com/t/gradle/blogs" data-toggle="popover" data-img="http://sfault-avatar.b0.upaiyun.com/298/812/2988127617-55bee533444ae_huge100" data-placement="top" data-original-title="gradle" data-id="1040000000493672">gradle</a></li>
                                            </ul>

                </div>
                <div class="clearfix mt10">
                    <ul class="article-operation list-inline pull-left">
                        <li><a href="http://segmentfault.com/a/1190000003763833" class="text-muted">链接</a></li>
                                                                                                <li class="dropdown">
                            <a href="javascript:void(0);" class="dropdown-toggle text-muted" data-toggle="dropdown">更多<b class="caret"></b></a>
                            <ul class="dropdown-menu dropdown-menu-left">
                                <li><a href="#911" data-toggle="modal" data-target="#911" data-type="article" data-id="1190000003763833" data-typetext="文章">举报</a></li>
                                                                        
                                                                        
                                                        </ul>
                        </li>
                    </ul>
                    <div class="pull-right post-share">
                        <div style="display: block;" class="widget-share sharer-0" data-text="我的gradle多渠道打包记录"><ul class="sn-inline"><li data-network="weibo"><a data-original-title="分享至新浪微博" href="javascript:void(0);" class="entypo-weibo icon-sn-weibo share-1" data-toggle="tooltip" data-placement="top" title="">新浪微博</a></li><li data-network="wechart"><a data-original-title="分享至微信" href="javascript:void(0);" class="entypo-wechart icon-sn-wechat share-2" data-toggle="tooltip" data-placement="top" title="">微信</a></li><li data-network="twitter"><a data-original-title="分享至 Twitter" href="javascript:void(0);" class="entypo-twitter icon-sn-twitter share-3" data-toggle="tooltip" data-placement="top" title="">Twitter</a></li><li data-network="facebook"><a data-original-title="分享至 Facebook" href="javascript:void(0);" class="entypo-facebook icon-sn-facebook share-4" data-toggle="tooltip" data-placement="top" title="">Facebook</a></li><li data-network="renren"><a data-original-title="分享至人人网" href="javascript:void(0);" class="entypo-renren icon-sn-renren share-5" data-toggle="tooltip" data-placement="top" title="">人人网</a></li><li data-network="douban"><a data-original-title="分享至豆瓣" href="javascript:void(0);" class="entypo-douban icon-sn-douban share-6" data-toggle="tooltip" data-placement="top" title="">豆瓣</a></li></ul></div>

                    </div>
                </div>

                <div class="text-center mt10">
                
                    <button type="button" id="mainLike" data-id="1190000003763833" class="btn btn-success btn-lg mr10">
                        0 推荐
                    </button>
                
                                    <button type="button" id="mainBookmark" data-type="article" data-id="1190000003763833" class="btn btn-default btn-lg ">
                        收藏
                    </button>
                                </div>

                
                                <div class="recommend-post pt30 mt40 mb30 border-top">
                    <h4 class="mt0">你可能感兴趣的文章</h4>
                    <ul class="widget-links list-unstyled">
                                                <li class="widget-links__item">
                            <a href="http://segmentfault.com/a/1190000002976401" title="加快Android Studio的编译速度">加快Android Studio的编译速度</a>
                            <small class="text-muted">
                                11 收藏，1.1k 浏览
                            </small>
                        </li>
                                                <li class="widget-links__item">
                            <a href="http://segmentfault.com/a/1190000002963895" title="Android Studio目录结构浅析">Android Studio目录结构浅析</a>
                            <small class="text-muted">
                                16 收藏，2.7k 浏览
                            </small>
                        </li>
                                                <li class="widget-links__item">
                            <a href="http://segmentfault.com/a/1190000003695442" title="快速了解AndroidStudio的Gradle">快速了解AndroidStudio的Gradle</a>
                            <small class="text-muted">
                                24 收藏，681 浏览
                            </small>
                        </li>
                                            </ul>
                </div>
                                <!-- <ul class="list-unstyled text-muted mt30">
                                        <li>上一篇：<a href="/a/1190000003711924">Android Studio：GIT提交项目到远程仓库</a></li>
                                                        </ul> -->

                <h2 class="h4 post-comment-title">讨论区</h2>
                <div class="widget-comments" id="comment-1190000003763833" data-id="1190000003763833">
                        <div class="widget-comments__form row">
                                    <div class="col-md-12">
                    请先 <a class="commentLogin" href="javascript:void(0);">登录</a> 后评论
                </div>
            
    </div><!-- /.widget-comments__form -->
    </div><!-- /.widget-comments -->



                                    
                
            </div><!-- /.main -->


            <div class="col-xs-12 col-md-3 side">
                <div class="sfad-sidebar">
    <div class="sfad-item" data-adn="ad-1119908" id="adid-1119908"><div id="BAIDU_DUP_wrapper_1119908_0"><iframe id="baidu_clb_slot_iframe_1119908_0" src="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/a.htm" onload="BAIDU_DUP_CLB_renderFrame('1119908_0')" vspace="0" hspace="0" allowtransparency="true" scrolling="no" marginwidth="0" marginheight="0" style="border:0; vertical-align:bottom; margin:0; display:block;" frameborder="0" height="150" width="233"></iframe></div></div>

</div>


                <div class="widget-box no-border">
                    <p class="text-muted">本文隶属于专栏</p>
                    <h4 class="fz16"><a href="http://segmentfault.com/blog/sanchi">share</a></h4>
                    <p class="wordbreak">我也是个菜鸟。希望大家都不会跟我一样走弯路~</p>
                                                        <button type="button" class="btn btn-default follow-article" data-do="follow" data-type="blog" data-id="1200000003409675">关注专栏</button>
                                                    </div>

                
                                
                <div style="display: block; width: 233px; top: 0px;" class="post-nav hidden-xs side-outline hidden-sm fixed">
                    <div class="panel panel-default widget-outline">
                        <div class="panel-heading">文章目录</div>
                        <div class="panel-body">
                            <div style="top: 0px;" class="nav-body">
                                <div style="display: block; top: 54px; height: 48px;" class="highlight-title"></div>
                                <ul class="articleIndex"><li class=""><a href="#articleHeader0">生成keystore</a></li><li class=""><a href="#articleHeader1">我的打包记录</a></li><li class="active"><a href="#articleHeader2">美团的打包方案（现阶段最快）</a></li></ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div><!-- /.side -->
        </div>
    </div>
</div>

<div id="shareToWeiboModal" class="modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">×</span><span class="sr-only">Close</span>
                </button>
                <h4 class="modal-title">分享</h4>
            </div>
            <div class="modal-body">
                <p class="sfModal-content">
                    分享到微博？
                </p>
            </div>
            <div class="modal-footer ">
                <button type="button" class="btn btn-default dont-likeweibo" data-dismiss="modal">取消并且不再弹出</button>
                <a href="" id="shareLink" class="btn btn-primary done-btn" target="_blank" onclick="$('#shareToWeiboModal').modal('hide')">分享</a>
            </div>
        </div>
    </div>
</div>

    <div class="widget-register widget-welcome-question mt20 hidden-xs widget-welcome widget-register-slideUp">
<div class="container">
    <div class="row">
        <div class="col-sm-12">
            <h2 class="title h4">与我们一起探索更多的未知</h2>
            <p>专业的开发者技术社区，为用户提供多样化的线上知识交流，丰富的线下活动及给力的工作机会</p>
        </div>
        <form action="/api/user/register/fast" method="post">
            <div class="col-sm-5">
                <div class="form-group mb0">
                    <input class="form-control" placeholder="邮箱地址" name="mail" required="" type="text">
                </div>
            </div>
            <div class="col-sm-3">
                <button type="submit" class="btn btn-primary btn-block">加入只需一步</button>
            </div>
            <div class="col-sm-10 mt10 captcha-part" style="display:none;">
                <div class="row">
                    <div class="col-sm-4 pr0">
                        <input class="form-control" name="captcha" placeholder="请输入验证码" disabled="disabled" required="" type="text">
                    </div>
                    <div class="col-sm-4 pr0">
                        <a href="javascript:void(0)"><img src="" height="35"></a>
                    </div>
                </div>
            </div>
        </form>
        <a class="close" href="javascript:void(0);"><span>×</span></a>
    </div>
</div>
</div>

<div id="911" class="modal widget-911">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">举报<span class="type-911">问题</span></h4>
            </div>
            <div class="modal-body">
                <p class="alert alert-warning" id="J_returnMsg" style="display:none"></p>
                <p><strong class="required">举报理由：</strong></p>
                <div id="reportDescription">
                <div class="radio-911 radio all">
                    <label>
                        <input name="descRadio" checked="checked" value="推广（招聘、广告、SEO 等）方面的内容" type="radio">
                        推广（招聘、广告、SEO 等）方面的内容
                    </label>
                </div>
                <div class="radio-911 radio all">
                    <label>
                        <input name="descRadio" value="带有人身攻击、辱骂、仇恨等违反条款的内容" type="radio">
                        带有人身攻击、辱骂、仇恨等违反条款的内容
                    </label>
                </div>
                <div class="radio-911 radio question-only">
                    <label>
                        <input name="descRadio" value="与已有问题重复" type="radio">
                        与已有问题重复（请编辑该提问指向已有相同问题）
                    </label>
                </div>
                <div class="radio-911 radio all">
                    <label>
                        <input name="descRadio" value="不友善内容" type="radio">
                        不友善内容
                    </label>
                </div>
                <div class="radio-911 radio answer-only">
                    <label>
                        <input name="descRadio" value="答非所问，不符合答题要求" type="radio">
                        答非所问，不符合答题要求
                    </label>
                </div>
                <div class="radio-911 radio all" id="btwRadio">
                    <label>
                        <input name="descRadio" value="" type="radio">
                        其他原因（请补充说明）
                    </label>
                </div>
                <div class="hide btw">
                    <p class="mt20"><strong>补充说明：</strong></p>
                    <textarea class="form-control" rows="3" autocomplete="false" id="911Desc"></textarea>
                </div>
                                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" id="911Submit" class="btn btn-primary">提交</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<footer id="footer">
<div class="container">
    <div class="row hidden-xs">
        <dl class="col-sm-2 site-link">
            <dt>网站相关</dt>
            <dd><a href="http://segmentfault.com/about">关于我们</a></dd>
            <dd><a href="http://segmentfault.com/tos">服务条款</a></dd>
            <dd><a href="http://segmentfault.com/faq">帮助中心</a></dd>
            <dd><a href="http://segmentfault.com/repu">声望与权限</a></dd>
            <dd><a href="http://segmentfault.com/markdown">编辑器语法</a></dd>
            <dd><a href="http://weekly.segmentfault.com/">每周精选</a></dd>
            <dd><a href="http://segmentfault.com/app">App 下载</a></dd>
        </dl>
        <dl class="col-sm-2 site-link">
            <dt>联系合作</dt>
            <dd><a href="http://segmentfault.com/contact">联系我们</a></dd>
            <dd><a href="http://segmentfault.com/hiring">加入我们</a></dd>
            <dd><a href="http://segmentfault.com/link">合作伙伴</a></dd>
            <dd><a href="http://segmentfault.com/press">媒体报道</a></dd>
            <dd><a href="http://0x.segmentfault.com/">建议反馈</a></dd>
            <dd><a href="http://pan.baidu.com/share/link?shareid=604288&amp;uk=839272106" target="_blank">Logo 下载</a></dd>
        </dl>
        <dl class="col-sm-2 site-link">
            <dt>常用链接</dt>
            <dd><a href="http://mirrors.segmentfault.com/" target="_blank">文档镜像</a></dd>
            <dd>订阅：<a href="http://segmentfault.com/feeds">问答</a> / <a href="http://segmentfault.com/feeds/blogs">文章</a></dd>
            <dd><a href="http://segmentfault.com/events?category=4">黑客马拉松</a></dd>
<!--             <dd><a href="http://zs.segmentfault.com/" target="_blank">一起涨姿势</a></dd> -->
            <dd><a href="https://namebeta.com/" target="_blank">域名搜索注册</a></dd>
        </dl>
        <dl class="col-sm-2 site-link">
            <dt>关注我们</dt>
            <dd><a href="https://twitter.com/segment_fault" target="_blank">Twitter</a></dd>
            <!-- <dd><a href="http://page.renren.com/699146294" target="_blank">人人网</a></dd> -->
            <dd><a href="https://www.linkedin.com/company/segmentfault" target="_blank">LinkedIn</a></dd>
            <dd><a href="http://weibo.com/segmentfault" target="_blank">新浪微博</a></dd>
            <dd><a href="http://i.youku.com/segmentfault" target="_blank">优酷主页</a></dd>
            <dd><a href="http://segmentfault.com/giveaways" target="_blank">开发者福利</a></dd>
            <dd><a href="http://segmentfault.com/blog/segmentfault" target="_blank">开发日志</a></dd>
        </dl>
        <dl class="col-sm-4 site-link" id="license">
            <dt>内容许可</dt>
            <dd>除特别说明外，用户内容均采用 <a rel="license" target="_blank" href="http://creativecommons.org/licenses/by-sa/3.0/cn/">知识共享署名-相同方式共享 3.0 中国大陆许可协议</a> 进行许可</dd>
            <dd>本站由 <a target="_blank" href="http://qingcloud.com/">青云 QingCloud</a> 提供云计算服务<br><a target="_blank" href="https://www.upyun.com/?utm_source=segmentfault&amp;utm_medium=link&amp;utm_campaign=upyun&amp;md=segmentfault">又拍云</a> 提供 CDN 存储服务</dd>
            <dd>
                <a target="_blank" key="55e59bd4efbfb0241247d4e4" logo_size="124x47" logo_type="realname" href="http://www.anquan.org/authenticate/cert/?site=segmentfault.com&amp;at=realname"><script src="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/hm.js"></script><script src="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/analytics.js" async=""></script><script src="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/aq_auth.js"></script><span style="display:none;" class="LOGO_aq_jsonp_wrap_" id="AQ_logo_span_init_1"><script async="true" type="text/javascript" src="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/a"></script></span><img alt="安全联盟认证" style="border: medium none;" src="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/sm_124x47.png" height="47" width="124"></a>
                <!-- Begin DigiCert site seal HTML and JavaScript -->
                <div id="DigiCertClickID_2bMgZTfe" data-language="en" style="float: left; margin-right: 10px"><div id="DigiCertClickID_2bMgZTfeSeal" style="text-decoration: none; text-align: center; display: block; vertical-align: baseline; font-size: 100%; font-style: normal; text-indent: 0px; line-height: 1; width: auto; margin: 0px auto; padding: 0px; border: 0px none; background: transparent none repeat scroll 0% 0%; position: relative; top: 0px; right: 0px; bottom: 0px; left: 0px; clear: both; float: none; cursor: default;"><img alt="DigiCert Seal" src="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/a.png" style="text-decoration: none; text-align: center; display: block; vertical-align: baseline; font-size: 100%; font-style: normal; text-indent: 0px; line-height: 1; width: auto; margin: 0px auto; padding: 0px; border: 0px none; background: transparent none repeat scroll 0% 0%; position: relative; top: 0px; right: 0px; bottom: 0px; left: 0px; clear: both; float: none; cursor: pointer;"></div></div>
                <script type="text/javascript">
                    var __dcid = __dcid || [];__dcid.push(["DigiCertClickID_2bMgZTfe", "3", "s", "black", "2bMgZTfe"]);(function(){var cid=document.createElement("script");cid.async=true;cid.src="//seal.digicert.com/seals/cascade/seal.min.js";var s = document.getElementsByTagName("script");var ls = s[(s.length - 1)];ls.parentNode.insertBefore(cid, ls.nextSibling);}());
                </script><script src="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/seal.js" async=""></script>
                <!-- End DigiCert site seal HTML and JavaScript -->
            </dd>
        </dl>
    </div>
    <div class="copyright">
        Copyright © 2011-2015 SegmentFault. 当前呈现版本 15.10.19<br><a href="http://www.miibeian.gov.cn/" rel="nofollow">浙ICP备15005796号-2</a>
    </div>
</div>
</footer>

<div id="fixedTools" class="hidden-xs hidden-sm">
  <a id="backtop" class="border-bottom" href="#">回顶部</a>
  <div class="qrcodeWraper">
    <a href="http://segmentfault.com/app#qrcode"><span class="glyphicon glyphicon-qrcode"></span></a>
    <img id="qrcode" class="border" alt="sf-wechat" src="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/appQrcode.png">
      <p class="qrcode-text">扫扫下载 App</p>
  </div>
</div>


<div class="app-promotion-bar">
    <a href="javascript:;"><i class="fa fa-close close"></i></a>
    <div class="icon"></div>
    <h5 class="title h5">SegmentFault</h5>
    <p class="describe">一起探索更多未知</p>
    <a class="download-btn btn btn-sm btn-primary" href="http://segmentfault.com/app#qrcode">下载 App</a>
</div>

<script id="loginModal" type="text/template">
<div class="row bg-white login-modal">
    <div class="col-md-4 col-sm-12 col-md-push-7 login-wrap">
        <h1 class="h4 text-muted login-title">用户登录</h1>
        <form action="/api/user/login" method="POST" role="form" class="mt30">
            <div class="form-group">
                <label class="control-label">Email</label>
                <input type="email" class="form-control" name="mail" required placeholder="hello@segmentfault.com">
            </div>
            <div class="form-group">
                <label class="control-label">密码</label>
                <input type="password" class="form-control" name="password" required placeholder="密码">
            </div>
            <div class="form-group clearfix">
                <div class="checkbox pull-left">
                    <label><input name="remember" type="checkbox" value="1" checked> 记住登录状态</label>
                </div>
                <button type="submit" class="btn btn-primary pull-right pl20 pr20">登录</button>
            </div>
        </form>
        <p class="h4 text-muted visible-xs-block h4">快速登录</p>
        <div class="widget-login mt30">
            <p class="text-muted mt5 mr10 pull-left hidden-xs">快速登录</p>
            <a href="/user/oauth/google" class="btn pl5 pr5 mb5 btn-default btn-sm btn-sn-google"><span class="icon-sn-google"></span> <strong class="visible-xs-inline">Google 账号</strong></a>
            <a href="/user/oauth/github" class="btn pl5 pr5 mb5 btn-default btn-sm btn-sn-github"><span class="icon-sn-github"></span> <strong class="visible-xs-inline">Github 账号</strong></a>
            <a href="/user/oauth/weibo" class="btn pl5 pr5 mb5 btn-default btn-sm btn-sn-weibo"><span class="icon-sn-weibo"></span> <strong class="visible-xs-inline">新浪微博账号</strong></a>
            <a href="/user/oauth/qq" class="btn pl5 pr5 mb5 btn-default btn-sm btn-sn-qq"><span class="icon-sn-qq"></span> <strong class="visible-xs-inline">QQ 账号</strong></a>
            <a href="/user/oauth/weixin" class="btn pl5 pr5 mb5 btn-default btn-sm btn-sn-wechat"><span class="icon-sn-wechat"></span> <strong class="visible-xs-inline">微信账号</strong></a>
            <button type="button" class="btn mb5 btn-default btn-sm btn-sn-more" id="loginShowMore">...</button>
            <a href="/user/oauth/twitter" class="btn pl5 pr5 mb5 btn-default btn-sn-twitter btn-sm hidden"><span class="icon-sn-twitter"></span> <strong class="visible-xs-inline">Twitter 账号</strong></a>
            <a href="/user/oauth/facebook" class="btn pl5 pr5 mb5 btn-default btn-sn-facebook btn-sm hidden"><span class="icon-sn-facebook"></span> <strong class="visible-xs-inline">Facebook 账号</strong></a>
            <a href="/user/oauth/douban" class="btn pl5 pr5 mb5 btn-default btn-sn-douban btn-sm hidden"><span class="icon-sn-douban"></span> <strong class="visible-xs-inline">豆瓣账号</strong></a>
        </div>
    </div>
    <div class="login-vline hidden-xs hidden-sm"></div>
    <div class="col-md-4 col-md-pull-3 col-sm-12 login-wrap">
        <h1 class="h4 text-muted login-title">创建新账号</h1>
        <form action="/api/user/register" method="POST" role="form" class="mt30">
            <div class="form-group">
                <label for="name" class="control-label">用户名</label>
                <input type="text" class="form-control" name="name" required placeholder="字母、数字等，用户名唯一">
            </div>
            <div class="form-group">
                <label for="mail" class="control-label">Email</label>
                <input type="hidden" style="display:none" name="mail">
                <input type="email" autocomplete="off" class="form-control register-mail" name="mail" required placeholder="hello@segmentfault.com">
            </div>
            <div class="form-group">
                <label for="password" class="control-label">密码</label>
                <input type="password" class="form-control" name="password" required placeholder="不少于 6 位">
            </div>
            <div class="form-group" style="display:none;">
                <label class="required control-label">验证码</label>
                <input type="text" class="form-control" id="captcha" name="captcha" placeholder="请输入下方的验证码">
                <div class="mt10"><a id="loginReloadCaptcha"  href="javascript:void(0)"><img data-src="/user/captcha?w=240&h=50" class="captcha" width="240" height="50" /></a></div>
            </div>
            <div class="form-group clearfix">
                <div class="checkbox pull-left">
                    同意并接受<a href="/tos" target="_blank">《服务条款》</a>
                </div>
                <button type="submit" class="btn btn-primary pl20 pr20 pull-right">注册</button>
            </div>
        </form>
    </div>
</div>
<div class="text-center text-muted mt30">
    <a href="/user/forgot" class="ml5">找回密码</a>
</div>
</script>


<script>
    (function (w) {
        w.SF = {
            staticUrl: "http://static.segmentfault.com",
        };
        w.SF.token = (function () {
    var _1kLW = '9'//'JzN'
+//'zog'
'97'+//'KjN'
'fbc'+/* 'AO'//'AO' */''+'308'//'j'
+'fb'//'Lg'
+//'cw'
'cw'+'07b'//'bG'
+''///*'D'*/'D'
+'79'//'i'
+//'r4'
'a3a'+//'t7'
'7'+//'q'
'4f'+//'Qq'
'1'+//'kR4'
'49'+//'tE'
'3'+//'y'
'1c'+/* 'p'//'p' */''+''///*'mv'*/'mv'
+'4f4'//'N'
+//'4r'
'4r'+//'Bo'
'b', _Wckp = [[11,13],[31,33]];

    for (var i = 0; i < _Wckp.length; i ++) {
        _1kLW = _1kLW.substring(0, _Wckp[i][0]) + _1kLW.substring(_Wckp[i][1]);
    }

    return _1kLW;
})();;
    })(window);
</script>

    <script src="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/assets.js"></script>
    <script>
    requirejs.config({
        baseUrl: "http://static.segmentfault.com/build/global/js"
    });
    </script>
            <script src="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/post.js"></script>
    
<script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-918487-8']);
  _gaq.push(['_trackPageview']);
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-918487-8', 'auto');
  ga('send', 'pageview');

</script>

<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e23800c454aa573c0ccb16b52665ac26";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>

<script src="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/m.js"></script>
<script>
if(typeof BAIDU_CLB_fillSlotAsync === 'function') {
    BAIDU_CLB_fillSlotAsync('981183','adid-981183');
    BAIDU_CLB_fillSlotAsync('981184','adid-981184');
    BAIDU_CLB_fillSlotAsync('981694','adid-981694');
    BAIDU_CLB_fillSlotAsync('981179','adid-981179');
    BAIDU_CLB_fillSlotAsync('1119908','adid-1119908');
}
</script>




<div id="noteWidget" class="noteWidget hidden hidden-xs">
    <div class="noteWidget-header clearfix">
        <h2 class="h4 pull-left">记笔记</h2>
        <ul class="list-inline pull-right mb0">
            <li id="noteWidgetMinimize"><span class="icon-minimize"></span></li><li id="noteWidgetZoom"><span class="icon-zoom"></span></li><li id="noteWidgetClose"><span class="icon-close"></span></li>
        </ul>
    </div>
    <form method="POST" action="/api/notes/add" role="form">
        <div class="form-group">
            <label for="title" class="sr-only">标题</label>
            <input value="" id="draftId" type="hidden">
            <input name="title" data-error="" autocomplete="off" class="form-control" placeholder="笔记描述" type="text">
        </div>
        <div class="editor-config clearfix">
            <select name="lang" class="form-control pull-left input-sm">
                <optgroup label="文本语法">
                    <option selected="selected" value="text" data-mode="text">纯文本</option>
                    <option value="markdown" data-mode="markdown">Markdown</option>
                    <option value="javascript" data-mode="javascript">Javascript</option>
                    <option value="css" data-mode="css">CSS</option>
                    <option value="html5" data-mode="htmlmixed">HTML</option>
                    <option value="php" data-mode="php">PHP</option>
                    <option value="python" data-mode="python">Python</option>
                    <option value="ruby" data-mode="ruby">Ruby</option>
                    <option value="go" data-mode="go">Go</option>
                    <option value="c" data-mode="clike">C/C++</option>
                    <option value="java" data-mode="java">Java</option>
                    <option value="bash" data-mode="shell">Shell/Bash</option>
                </optgroup>
            </select>
            <div class="pull-right hidden-xs">
                <select name="indentWithTabs" class="form-control inline-block input-sm">
                    <optgroup label="缩进模式">
                        <option selected="selected" value="false">空格缩进</option>
                        <option value="true">Tabs 缩进</option>
                    </optgroup>
                </select>
                <select name="tabSize" class="form-control inline-block input-sm">
                    <optgroup label="缩进大小">
                        <option value="2">2</option>
                        <option value="4" selected="selected">4</option>
                    </optgroup>
                </select>
                <select name="lineWrap" class="form-control inline-block input-sm">
                    <optgroup label="换行方式">
                        <option selected="selected" value="true">自动换行</option>
                        <option value="false">不换行</option>
                    </optgroup>
                </select>
            </div>
        </div>
        <textarea id="codeMirror" class="form-control" style="display: none;"></textarea><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px;"><textarea tabindex="0" spellcheck="false" autocapitalize="off" autocorrect="off" style="position: absolute; padding: 0px; width: 1px; height: 1em; outline: medium none;" wrap="off"></textarea></div><div style="left: 0px;" class="CodeMirror-hscrollbar"><div style="height: 100%; min-height: 1px;"></div></div><div class="CodeMirror-vscrollbar"><div style="min-width: 1px;"></div></div><div class="CodeMirror-scrollbar-filler"></div><div class="CodeMirror-gutter-filler"></div><div draggable="true" tabindex="-1" class="CodeMirror-scroll"><div style="margin-left: 0px;" class="CodeMirror-sizer"><div style="position: relative;"><div class="CodeMirror-lines"><div style="position: relative; outline: medium none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"></div></div></div></div></div><div style="position: absolute; height: 30px; width: 1px;"></div><div class="CodeMirror-gutters"><div style="width: 1px;" class="CodeMirror-gutter CodeMirror-linenumbers"></div></div></div></div>
        <div class="mt20 clearfix">
            <div class="pull-right">
                <span class="text-muted hidden" id="editorStatus">已保存</span>
                <a id="dropIt" href="javascript:void(0);" class="mr10 hidden">[舍弃]</a>
                <button data-type="note" id="publishIt2" class="btn btn-default ml10" data-id="" data-do="add" data-url="" data-text="保存私密笔记" data-name="">保存私密笔记</button>
                <button data-type="note" id="publishIt" class="btn btn-primary ml10" data-id="" data-do="add" data-url="" data-text="保存公开笔记" data-name="">保存公开笔记</button>
                </div>
            </div>
        </form></div>
    
<div style="position: absolute; left: 0px; top: -9999px; width: 1px; height: 1px; z-index: 999999999;" class="global-zeroclipboard-container" id="global-zeroclipboard-html-bridge"><object id="global-zeroclipboard-flash-bridge" name="global-zeroclipboard-flash-bridge" type="application/x-shockwave-flash" data="%E6%88%91%E7%9A%84gradle%E5%A4%9A%E6%B8%A0%E9%81%93%E6%89%93%E5%8C%85%E8%AE%B0%E5%BD%95%20-%20SegmentFault_files/ZeroClipboard.swf" height="100%" width="100%"><param name="allowScriptAccess" value="always"><param name="allowNetworking" value="all"><param name="menu" value="false"><param name="wmode" value="transparent"><param name="flashvars" value="trustedOrigins=segmentfault.com%2C%2F%2Fsegmentfault.com%2Chttp%3A%2F%2Fsegmentfault.com&amp;swfObjectId=global-zeroclipboard-flash-bridge"></object></div><div id="atwho-container"></div></body></html>